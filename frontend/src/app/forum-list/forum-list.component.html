<h2>Forum History</h2>
<table mat-table matSort matSortActive="date"
       matSortDirection="asc" #sortForums [dataSource]="forumsDataSource">
  <!-- Users Column -->
  <ng-container matColumnDef="users">
    <th mat-header-cell *matHeaderCellDef> Users</th>
    <td mat-cell *matCellDef="let forum">
      <mat-form-field class="forum-users-chip-list">
        <mat-chip-list #usersChipList aria-label="User selection">
          <mat-chip
            *ngFor="let user of forum.users"
            [selectable]="false"
            [removable]="(currentUser$ | async)?.is_admin_of_mador"
            (removed)="removeUserFromForum(user, forum)">
            {{user.username}}
            <mat-icon matChipRemove>cancel</mat-icon>
          </mat-chip>
          <input
              #userForumInput
              [formControl]="forumUserChipCtrl"
              [matAutocomplete]="auto"
              [matChipInputFor]="usersChipList"
              [matChipInputSeparatorKeyCodes]="environment.separatorKeysCodes"
              [matChipInputAddOnBlur]="true"
              (matChipInputTokenEnd)="addUserToForum(forum)">
        </mat-chip-list>
        <mat-autocomplete #auto="matAutocomplete" (optionSelected)="onSelectedUser($event)">
          <mat-option *ngFor="let user of filteredUsers | async" [value]="user">
            {{user.name}} ({{user.username}})
          </mat-option>
        </mat-autocomplete>
      </mat-form-field>
    </td>
  </ng-container>

  <!-- Date Column -->
  <ng-container matColumnDef="date">
    <th mat-header-cell mat-sort-header="date" *matHeaderCellDef>Date</th>
    <td mat-cell *matCellDef="let forum">
      <mat-form-field>
        <input matInput type="date" [disabled]="!(currentUser$ | async)?.is_admin_of_mador"
               value="{{forum.date | date:'yyyy-MM-dd'}}"
               [(ngModel)]="forum.date"
               (ngModelChange)="updateForum(forum)">
      </mat-form-field>
    </td>
  </ng-container>

  <!-- Budget Column -->
  <ng-container matColumnDef="budget">
    <th mat-header-cell mat-sort-header="budget" *matHeaderCellDef>Budget</th>
    <td mat-cell *matCellDef="let forum">
      <mat-form-field>
        <input matInput type="number" min="0" [disabled]="!(currentUser$ | async)?.is_admin_of_mador"
               [(ngModel)]="forum.budget"
               (ngModelChange)="updateForum(forum)">
      </mat-form-field>
    </td>
  </ng-container>

  <!-- Notes Column -->
  <ng-container matColumnDef="notes">
    <th mat-header-cell *matHeaderCellDef>Notes</th>
    <td mat-cell *matCellDef="let forum">
      <mat-form-field>
                <textarea matInput type="text" [disabled]="!(currentUser$ | async)?.is_admin_of_mador"
                          [(ngModel)]="forum.notes"
                          (ngModelChange)="updateForum(forum)"></textarea>
      </mat-form-field>
    </td>
  </ng-container>

  <!-- Remove Column -->
  <ng-container matColumnDef="remove">
    <th mat-header-cell *matHeaderCellDef></th>
    <td mat-cell *matCellDef="let forum">
      <button mat-icon-button
              [disabled]="!(currentUser$ | async)?.is_admin_of_mador"
              [matTooltipPosition]="'above'"
              matTooltip="Remove"
              (click)="removeForum($event, forum)">
        <mat-icon>close</mat-icon>
      </button>
    </td>
  </ng-container>

  <tr mat-header-row *matHeaderRowDef="forumsTableColumnsToDisplay"></tr>
  <tr mat-row *matRowDef="let row; columns: forumsTableColumnsToDisplay;"></tr>
</table>
<button type="submit" mat-raised-button color="primary" (click)="addForum()" *ngIf="currentUser$" [disabled]="!(currentUser$ | async)?.is_admin_of_mador">
  <mat-icon>add</mat-icon>
  Manually add a forum
</button>
